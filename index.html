<html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
        .atleta {
            width: 100%;
            margin: 5px;
            padding: 10px;
            cursor: pointer;
        }

        .maschile {
            background-color: lightblue;
        }

        .femminile {
            background-color: mistyrose;
        }
        
        @media screen and (max-width: 992px) {
            .atleta {
                height: 100px;
                padding: 40px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <canvas id="myChart" style="margin-top:20px; width:80vw; height: 300px;"></canvas>
        </br>
        </br>
        </br>
        <div class="row">
            <div class="col">
                <div class="accordion" id='lista-atleti-femmine'>

                </div>
                </br>
                </br>
                </br>
                <div class="accordion" id='lista-atleti-maschi'>

                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.0/chart.umd.js"></script>

</body>
<script>
    const atletiMaschi = [{"nome":"PIERPAOLI NICOLO'","dataNascita":"09/06/2003","sex":"M","posizione":126,"storico":[101,114,136,115,146,165,189,192,148,126],"variazione":"+"},{"nome":"CONTE LEONARDO","dataNascita":"04/05/2001","sex":"M","posizione":149,"storico":[183,191,163,170,203,194,154,168,180,149],"variazione":"+"},{"nome":"BARCHIESI GABRIELE","dataNascita":"01/08/1997","sex":"M","posizione":177,"storico":[119,130,133,125,159,171,176,172,188,177],"variazione":"+"},{"nome":"GIAMPAOLETTI MICHELE","dataNascita":"07/10/2006","sex":"M","posizione":251,"storico":[365,346,328,290,209,291,278,276,260,251],"variazione":"+"},{"nome":"MELUCCI MICHELE","dataNascita":"23/03/2000","sex":"M","posizione":254,"storico":[243,264,280,303,255,238,255,260,234,254],"variazione":"-"},{"nome":"APPOLLONI NICOLO'","dataNascita":"16/12/1996","sex":"M","posizione":450,"storico":[254,261,333,357,369,388,408,409,431,450],"variazione":"-"},{"nome":"CAVALLO MATTEO","dataNascita":"15/08/1994","sex":"M","posizione":491,"storico":[600,516,538,551,565,635,596,588,527,491],"variazione":"+"},{"nome":"PERSICHINI RAFFAELE","dataNascita":"02/12/1997","sex":"M","posizione":573,"storico":[387,424,424,506,621,564,563,537,553,573],"variazione":"-"},{"nome":"MANONI LUIGI","dataNascita":"13/12/1954","sex":"M","posizione":750,"storico":[851,892,790,820,838,807,827,840,843,750],"variazione":"+"},{"nome":"PIOPPI RAFFAELE","dataNascita":"23/06/2004","sex":"M","posizione":817,"storico":[1391,1452,1417,1283,1343,994,1032,988,964,817],"variazione":"+"},{"nome":"FIORENTINI LORENZO","dataNascita":"05/06/1998","sex":"M","posizione":967,"storico":[800,838,833,823,853,869,894,907,930,967],"variazione":"-"},{"nome":"PAPAVERI DORIANO","dataNascita":"14/10/1964","sex":"M","posizione":1017,"storico":[1509,1500,1202,1052,1215,1418,1235,1250,1264,1017],"variazione":"+"},{"nome":"IERONFANTICO ANDREA","dataNascita":"04/01/2004","sex":"M","posizione":1019,"storico":[1324,1301,1275,1188,1117,967,930,863,828,1019],"variazione":"-"},{"nome":"AZZALINI MICHELE","dataNascita":"22/11/1971","sex":"M","posizione":1054,"storico":[null,null,null,null,1431,1105,909,1005,1023,1054],"variazione":"-"},{"nome":"FASULO EDUARDO","dataNascita":"17/07/1959","sex":"M","posizione":1058,"storico":[735,771,828,842,954,978,1024,1088,1107,1058],"variazione":"+"},{"nome":"FABRI MARCO","dataNascita":"26/04/1977","sex":"M","posizione":1154,"storico":[1286,1315,1162,1139,1049,1029,1092,916,1017,1154],"variazione":"-"},{"nome":"ANGELUCCI MATTEO","dataNascita":"18/09/2003","sex":"M","posizione":1534,"storico":[1250,1271,1285,1319,1369,1410,1454,1487,1503,1534],"variazione":"-"},{"nome":"PAUCCHI FABIO","dataNascita":"20/02/1965","sex":"M","posizione":4106,"storico":[null,null,4550,4509,4436,4312,4345,4375,4348,4106],"variazione":"+"},{"nome":"GIULIONI CRISTIANO","dataNascita":"03/08/1983","sex":"M","posizione":4968,"storico":[4965,5131,5258,5114,5224,4947,4952,4886,4914,4968],"variazione":"-"},{"nome":"SCHIAROLI ALESSANDRO","dataNascita":"16/09/1969","sex":"M","posizione":5201,"storico":[4714,4884,5142,5148,5125,5103,5104,5113,5141,5201],"variazione":"-"}];
    const atletiFemmine = [{"nome":"PAUCCHI MARTINA","dataNascita":"29/08/1999","sex":"F","posizione":236,"storico":[null,213,219,223,234,240,247,253,254,236],"variazione":"+"},{"nome":"CONTI ANGELA","dataNascita":"14/10/1963","sex":"F","posizione":373,"storico":[319,334,333,341,348,353,359,362,361,373],"variazione":"-"},{"nome":"RUSSO LUCIA","dataNascita":"28/05/1967","sex":"F","posizione":679,"storico":[575,585,589,611,621,629,639,643,669,679],"variazione":"-"},{"nome":"CESARINI ALESSANDRA","dataNascita":"22/08/1991","sex":"F","posizione":800,"storico":[618,646,650,678,689,720,732,738,793,800],"variazione":"-"}];
    
    const accordionItemTemplate = `
            <div class="atleta ##genere" onclick="aggiornaAndamento('##genere', ##IndiceAtleta)">
                          <div class="row w-100">  
                            <div class="col-1">                                
                                ##VariazioneAtleta</div>
                            <div class="col">##NomeAtleta</div>
                            <div class="col-1">##PosizioneAtleta</div>
                         </div>
                    </div>
    `;

    function listaAtleti(atleti, rootElement, genere) {
        for (let i = 0; i < atleti.length; i++) {
            const atleta = atleti[i];

            let atletaTemplate = accordionItemTemplate.replaceAll('##NomeAtleta', atleta.nome);
            atletaTemplate = atletaTemplate.replaceAll('##genere', genere);
            atletaTemplate = atletaTemplate.replaceAll('##PosizioneAtleta', atleta.posizione);
            atletaTemplate = atletaTemplate.replaceAll('##IndiceAtleta', i);
            atletaTemplate = atletaTemplate.replaceAll('##StoricoAlteta', atleta.storico.join(' - '));

            if (atleta.variazione === '+') {
                atletaTemplate = atletaTemplate.replaceAll('##VariazioneAtleta', `<i class="fa fa-caret-up fa-lg" style='color:green' aria-hidden="true"></i>`);
            }
            if (atleta.variazione === '-') {
                atletaTemplate = atletaTemplate.replaceAll('##VariazioneAtleta', `<i class="fa fa-caret-down fa-lg" style='color:red' aria-hidden="true"></i>`);
            }
            if (atleta.variazione === '=') {
                atletaTemplate = atletaTemplate.replaceAll('##VariazioneAtleta', ` <i class="fa fa-caret-left fa-lg" style='color:gray' aria-hidden="true"></i> <i class="fa fa-caret-right fa-lg" style='color:gray' aria-hidden="true"></i>`);
            }
            rootElement.innerHTML += atletaTemplate;

        }
    }


    function createChart() {

        const xValues = [];

        return new Chart("myChart", {
            type: "line",
            data: {
                labels: xValues,
                datasets: [{
                    data: [],
                    borderColor: "gray",
                    fill: false
                }]
            },
            options: {
                scales: {
                    y: {
                        reverse: true
                    }
                }        
            }         
        });
    }

    const chartAndamento = createChart();

    function aggiornaAndamento(genere, indice) {
        let lista = atletiMaschi;
        if (genere === 'femminile') {
            lista = atletiFemmine;
        }

        const posizioni = lista[indice].storico;
        const labels = [...Array(posizioni.length).keys()];
        updateData(chartAndamento, labels, posizioni)
    }

    function updateData(chart, labels, data) {
        chart.data.labels = labels;
        chart.data.datasets.forEach((dataset) => {
            dataset.data = data;
        });
        chart.update();
    }

    

    document.addEventListener('DOMContentLoaded', function () {

      
        const rootMaschi = document.getElementById("lista-atleti-maschi");
        const rootFemmine = document.getElementById("lista-atleti-femmine");
        listaAtleti(atletiFemmine, rootFemmine, 'femminile');
        listaAtleti(atletiMaschi, rootMaschi, 'maschile');

    }, false);



</script>

</html>